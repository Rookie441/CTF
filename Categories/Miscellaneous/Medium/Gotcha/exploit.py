from PIL import Image
from io import BytesIO
import base64
import pytesseract
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.keys import Keys

chrome_driver_path = "C:\\chromedriver.exe"  
service = Service(chrome_driver_path)
driver = webdriver.Chrome(service=service)

# Navigate to the website
driver.get("http://34.124.157.94:5003/")

while True:
    # Get the image data from src and decode in base64
    image_element = driver.find_element(By.CLASS_NAME, "img-fluid")
    image_url = image_element.get_attribute("src")
    image_strip = image_url[23:]
    image_data = base64.b64decode(image_strip)

    # Create a PIL Image object from the decoded image data
    image = Image.open(BytesIO(image_data))

    # Perform OCR using Tesseract
    pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract'
    text = pytesseract.image_to_string(image)

    # Extra Improvements
    final = text.upper()[:4]
    print(final)

    # Submitting Result
    captcha_field = driver.find_element(By.ID, "captch_form")
    captcha_field.clear()
    captcha_field.send_keys(final)
    captcha_field.send_keys(Keys.ENTER)

